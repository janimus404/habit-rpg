<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0e27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quest Tracker">
    <meta name="description" content="Level Up Dein Leben - RPG Habit Tracker">
    <link rel="manifest" href="#" id="manifest-placeholder">
    <title>Quest Tracker - Level Up Dein Leben</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');
        
        :root {
            --bg-dark: #0a0e27;
            --bg-panel: #1a1f3a;
            --bg-quest: #252b4a;
            --accent-gold: #ffd700;
            --accent-blue: #4da6ff;
            --accent-green: #00ff88;
            --accent-red: #ff4444;
            --text-primary: #e0e6ff;
            --text-dim: #8892b0;
            --border: #3a4466;
            --xp-bar: linear-gradient(90deg, #00ff88, #00cc88);
            --shadow: rgba(0, 0, 0, 0.6);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'VT323', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255,255,255,0.02) 2px, rgba(255,255,255,0.02) 4px),
                radial-gradient(circle at 20% 80%, rgba(77, 166, 255, 0.1), transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.08), transparent 50%);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: var(--bg-panel);
            border: 3px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .title {
            font-family: 'Press Start 2P', monospace;
            font-size: 2.5rem;
            color: var(--accent-gold);
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.5), 0 0 20px rgba(255,215,0,0.4);
            position: relative;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 3px 3px 0 rgba(0,0,0,0.5), 0 0 20px rgba(255,215,0,0.4); }
            to { text-shadow: 3px 3px 0 rgba(0,0,0,0.5), 0 0 30px rgba(255,215,0,0.6); }
        }
        
        .subtitle {
            text-align: center;
            font-size: 1.3rem;
            color: var(--text-dim);
            margin-bottom: 30px;
        }
        
        .player-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            position: relative;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.05);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-3px);
            border-color: var(--accent-gold);
            box-shadow: 0 6px 20px rgba(255,215,0,0.3);
        }
        
        .stat-label {
            font-size: 1rem;
            color: var(--text-dim);
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-family: 'Press Start 2P', monospace;
            font-size: 1.8rem;
            color: var(--accent-gold);
        }
        
        .xp-container {
            grid-column: 1 / -1;
            padding: 20px;
        }
        
        .xp-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .xp-bar {
            height: 30px;
            background: rgba(0,0,0,0.4);
            border: 2px solid var(--border);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .xp-fill {
            height: 100%;
            background: var(--xp-bar);
            transition: width 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: relative;
            box-shadow: inset 0 2px 10px rgba(255,255,255,0.3);
        }
        
        .xp-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.4), transparent);
        }
        
        /* Quest Tabs */
        .quest-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            background: var(--bg-panel);
            border: 2px solid var(--border);
            padding: 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.9rem;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tab:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        .tab.active {
            background: var(--accent-blue);
            color: var(--bg-dark);
            border-color: var(--accent-blue);
            box-shadow: 0 4px 16px rgba(77, 166, 255, 0.4);
        }
        
        .tab-icon-only {
            flex: 0 0 60px;
            font-size: 1.5rem;
            padding: 10px;
        }
        
        /* Quest Lists */
        .quest-section {
            display: none;
        }
        
        .quest-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .quest-category {
            background: var(--bg-panel);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .category-title {
            font-family: 'Press Start 2P', monospace;
            font-size: 1.2rem;
            color: var(--accent-gold);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-icon {
            font-size: 1.5rem;
        }
        
        .quest-item {
            background: var(--bg-quest);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .quest-item:hover {
            border-color: var(--accent-green);
            transform: translateX(5px);
        }
        
        .quest-item.completed {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--accent-green);
        }
        
        .quest-item.completed::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--accent-green);
        }
        
        .quest-checkbox {
            width: 30px;
            height: 30px;
            border: 3px solid var(--border);
            border-radius: 4px;
            background: rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .quest-item.completed .quest-checkbox {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }
        
        .quest-checkbox::after {
            content: '‚úì';
            font-size: 1.5rem;
            color: var(--bg-dark);
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }
        
        .quest-item.completed .quest-checkbox::after {
            opacity: 1;
            transform: scale(1);
        }
        
        .quest-text {
            flex: 1;
            font-size: 1.3rem;
        }
        
        .quest-item.completed .quest-text {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .quest-xp {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.8rem;
            color: var(--accent-gold);
            padding: 5px 10px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 4px;
        }
        
        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            flex: 1;
            min-width: 200px;
            padding: 15px 30px;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.9rem;
            border: 3px solid;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .btn-primary {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: var(--bg-dark);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 255, 136, 0.4);
        }
        
        .btn-secondary {
            background: transparent;
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }
        
        .btn-secondary:hover {
            background: var(--accent-blue);
            color: var(--bg-dark);
        }
        
        .btn-danger {
            background: transparent;
            border-color: var(--accent-red);
            color: var(--accent-red);
        }
        
        .btn-danger:hover {
            background: var(--accent-red);
            color: var(--bg-dark);
        }
        
        /* Level Up Animation */
        .level-up-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .level-up-overlay.show {
            display: flex;
        }
        
        .level-up-content {
            text-align: center;
            animation: levelUpBounce 0.6s ease;
        }
        
        @keyframes levelUpBounce {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .level-up-title {
            font-family: 'Press Start 2P', monospace;
            font-size: 3rem;
            color: var(--accent-gold);
            margin-bottom: 20px;
            text-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
        }
        
        .level-up-text {
            font-size: 2rem;
            color: var(--accent-green);
        }
        
        /* Stats Panel */
        .stats-panel {
            background: var(--bg-panel);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid var(--accent-blue);
        }
        
        .stat-item-label {
            color: var(--text-dim);
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .stat-item-value {
            font-family: 'Press Start 2P', monospace;
            font-size: 1.5rem;
            color: var(--accent-green);
        }
        
        /* Todo Items */
        .todo-item {
            background: var(--bg-quest);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        
        .todo-item:hover {
            border-color: var(--accent-blue);
            transform: translateX(5px);
        }
        
        .todo-item.completed {
            opacity: 0.6;
        }
        
        .todo-item.completed .todo-text {
            text-decoration: line-through;
        }
        
        .todo-text {
            flex: 1;
            font-size: 1.3rem;
        }
        
        .todo-delete {
            background: transparent;
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }
        
        .todo-delete:hover {
            background: var(--accent-red);
            color: var(--bg-dark);
        }
        
        /* Manage Quests List */
        .manage-quest-item {
            background: var(--bg-quest);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .manage-quest-item:hover {
            border-color: var(--accent-red);
            transform: translateX(5px);
            background: rgba(255, 68, 68, 0.1);
        }
        
        .manage-quest-item.custom {
            border-left: 4px solid var(--accent-blue);
        }
        
        .manage-quest-category {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.7rem;
            color: var(--text-dim);
            padding: 4px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        
        /* Theme Selection */
        .theme-option {
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .theme-option:hover {
            transform: translateY(-5px);
        }
        
        .theme-preview {
            height: 100px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .theme-option:hover .theme-preview {
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
        }
        
        .theme-option.active .theme-preview {
            box-shadow: 0 0 0 4px var(--accent-gold), 0 8px 24px rgba(255,215,0,0.4);
        }
        
        .theme-name {
            font-family: 'Press Start 2P', monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .title {
                font-size: 1.2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .quest-tabs {
                flex-direction: column;
            }
            
            .tab {
                font-size: 0.8rem;
                padding: 12px;
            }
            
            .btn {
                min-width: 100%;
                font-size: 0.8rem;
                padding: 12px 20px;
            }
            
            .quest-text {
                font-size: 1.1rem;
            }
            
            .quest-xp {
                font-size: 0.7rem;
            }
            
            .category-title {
                font-size: 1rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .player-stats {
                gap: 10px;
            }
            
            .stat-box {
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1.3rem;
            }
            
            input[type="text"], input[type="number"], select {
                font-size: 1rem !important;
            }
            
            .todo-delete {
                font-size: 0.6rem;
                padding: 6px 10px;
            }
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 1rem;
            }
            
            .level-up-title {
                font-size: 2rem;
            }
            
            .level-up-text {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Player Stats -->
        <div class="header">
            <h1 class="title">‚öîÔ∏è QUEST TRACKER ‚öîÔ∏è</h1>
            <p class="subtitle">Level Up Dein Leben</p>
            
            <div class="player-stats">
                <div class="stat-box">
                    <div class="stat-label">Level</div>
                    <div class="stat-value" id="playerLevel">1</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Perfekt-Streak</div>
                    <div class="stat-value" id="currentStreak" style="font-size: 1.5rem;">0üî•</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Aktiv-Streak</div>
                    <div class="stat-value" id="partialStreak" style="font-size: 1.5rem; color: var(--accent-blue);">0‚ö°</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Heute</div>
                    <div class="stat-value" id="todayProgress">0/0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Diese Woche</div>
                    <div class="stat-value" id="weekProgress">0/0</div>
                </div>
                
                <div class="xp-container">
                    <div class="xp-label">
                        <span>Erfahrung</span>
                        <span id="xpText">0 / 100 XP</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Quest Tabs -->
        <div class="quest-tabs">
            <button class="tab active" onclick="switchTab('daily')">üìÖ Daily Quests</button>
            <button class="tab" onclick="switchTab('weekly')">üìÜ Weekly Quests</button>
            <button class="tab" onclick="switchTab('todo')">üìù To-Do</button>
            <button class="tab" onclick="switchTab('manage')">‚öôÔ∏è Quests Verwalten</button>
            <button class="tab" onclick="switchTab('stats')">üìä Statistiken</button>
            <button class="tab tab-icon-only" onclick="switchTab('settings')" title="Einstellungen">‚öôÔ∏è</button>
        </div>
        
        <!-- Daily Quests -->
        <div id="daily" class="quest-section active">
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üìö</span> Schule / Fokus</h2>
                <div id="daily-schule"></div>
            </div>
            
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üí™</span> Gesundheit</h2>
                <div id="daily-gesundheit"></div>
            </div>
            
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üßπ</span> Ordnung</h2>
                <div id="daily-ordnung"></div>
            </div>
            
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üß†</span> Mindset</h2>
                <div id="daily-mindset"></div>
            </div>
        </div>
        
        <!-- Weekly Quests -->
        <div id="weekly" class="quest-section">
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üèãÔ∏è</span> K√∂rper</h2>
                <div id="weekly-koerper"></div>
            </div>
            
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üéì</span> Schule / Zukunft</h2>
                <div id="weekly-schule"></div>
            </div>
            
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üåü</span> Life</h2>
                <div id="weekly-life"></div>
            </div>
        </div>
        
        <!-- To-Do List -->
        <div id="todo" class="quest-section">
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">üìù</span> Deine To-Dos</h2>
                <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                    <input type="text" id="todoInput" placeholder="Neue Aufgabe eingeben..." 
                           style="flex: 1; padding: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; background: var(--bg-quest); border: 2px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                    <button onclick="addTodo()" class="btn btn-primary" style="padding: 12px 30px; min-width: auto; white-space: nowrap;">+ Add</button>
                </div>
                <div id="todoList"></div>
            </div>
        </div>
        
        <!-- Quest Management -->
        <div id="manage" class="quest-section">
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">‚öôÔ∏è</span> Quests Verwalten</h2>
                
                <!-- Add Custom Quest -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 6px; margin-bottom: 30px;">
                    <h3 style="font-family: 'Press Start 2P', monospace; font-size: 1rem; color: var(--accent-blue); margin-bottom: 15px;">‚ûï Neue Quest Hinzuf√ºgen</h3>
                    <div style="display: grid; gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-dim);">Quest Typ:</label>
                            <select id="newQuestType" style="width: 100%; padding: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; background: var(--bg-quest); border: 2px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                                <option value="daily-schule">Daily - Schule / Fokus</option>
                                <option value="daily-gesundheit">Daily - Gesundheit</option>
                                <option value="daily-ordnung">Daily - Ordnung</option>
                                <option value="daily-mindset">Daily - Mindset</option>
                                <option value="weekly-koerper">Weekly - K√∂rper</option>
                                <option value="weekly-schule">Weekly - Schule / Zukunft</option>
                                <option value="weekly-life">Weekly - Life</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-dim);">Quest Beschreibung:</label>
                            <input type="text" id="newQuestText" placeholder="z.B. 30 min Meditation" style="width: 100%; padding: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; background: var(--bg-quest); border: 2px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; color: var(--text-dim);">XP Belohnung:</label>
                            <input type="number" id="newQuestXP" value="10" min="1" max="100" style="width: 100%; padding: 12px; font-family: 'VT323', monospace; font-size: 1.2rem; background: var(--bg-quest); border: 2px solid var(--border); border-radius: 6px; color: var(--text-primary);">
                        </div>
                        <button onclick="addCustomQuest()" class="btn btn-primary">Quest Hinzuf√ºgen</button>
                    </div>
                </div>
                
                <!-- Manage Existing Quests -->
                <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 6px;">
                    <h3 style="font-family: 'Press Start 2P', monospace; font-size: 1rem; color: var(--accent-red); margin-bottom: 15px;">üóëÔ∏è Quests Entfernen</h3>
                    <p style="color: var(--text-dim); margin-bottom: 15px;">Klicke auf eine Quest um sie dauerhaft zu entfernen:</p>
                    <div id="manageQuestsList"></div>
                </div>
            </div>
        </div>
        
        <!-- Statistics -->
        <div id="stats" class="quest-section">
            <div class="stats-panel">
                <h2 class="category-title"><span class="category-icon">üìä</span> Deine Statistiken</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-item-label">Gesamt XP</div>
                        <div class="stat-item-value" id="totalXP">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">Quests Abgeschlossen</div>
                        <div class="stat-item-value" id="totalCompleted">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">L√§ngste Perfekt-Streak</div>
                        <div class="stat-item-value" id="longestStreak">0 Tage üî•</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">L√§ngste Aktiv-Streak</div>
                        <div class="stat-item-value" id="longestPartialStreak" style="color: var(--accent-blue);">0 Tage ‚ö°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-item-label">Erfolgsrate</div>
                        <div class="stat-item-value" id="successRate">0%</div>
                    </div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="stats-panel" style="margin-top: 20px;">
                <h2 class="category-title"><span class="category-icon">üìà</span> Fortschritts-√úbersicht</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 30px; margin-top: 20px;">
                    <!-- Quest Completion Chart -->
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px;">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-blue); margin-bottom: 20px; text-align: center;">Quest Verteilung</h3>
                        <canvas id="questPieChart" style="max-height: 250px;"></canvas>
                    </div>
                    
                    <!-- XP Progress Chart -->
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px;">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-green); margin-bottom: 20px; text-align: center;">XP nach Kategorie</h3>
                        <canvas id="xpBarChart" style="max-height: 250px;"></canvas>
                    </div>
                    
                    <!-- Weekly Progress Chart -->
                    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; grid-column: 1 / -1;">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 20px; text-align: center;">7-Tage Verlauf</h3>
                        <canvas id="weeklyLineChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings -->
        <div id="settings" class="quest-section">
            <!-- Streak Settings -->
            <div class="quest-category">
                <h2 class="category-title"><span class="category-icon">‚ö°</span> Streak Einstellungen</h2>
                
                <div style="display: grid; gap: 20px; margin-top: 20px;">
                    <!-- Min Quests for Active Streak -->
                    <div style="background: rgba(77,166,255,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-blue);">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-blue); margin-bottom: 15px;">Mindest-Quests f√ºr Aktiv-Streak</h3>
                        <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 1.1rem;">Wie viele Daily Quests musst du mindestens erledigen, damit die Aktiv-Streak weiterl√§uft?</p>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="minQuestsSlider" min="1" max="10" value="3" 
                                   oninput="updateMinQuestsSetting(this.value)"
                                   style="flex: 1; height: 8px; background: var(--bg-quest); border-radius: 4px; outline: none; cursor: pointer;">
                            <span id="minQuestsValue" style="font-family: 'Press Start 2P', monospace; font-size: 1.2rem; color: var(--accent-blue); min-width: 80px; text-align: center;">3 Quests</span>
                        </div>
                    </div>
                    
                    <!-- Hardcore Mode -->
                    <div style="background: rgba(255,68,68,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-red);">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-red); margin-bottom: 15px;">üî• Hardcore Modus</h3>
                        <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 1.1rem;">
                            <strong>AUS:</strong> Perfekt-Streak bleibt erhalten wenn du die Aktiv-Streak schaffst<br>
                            <strong>EIN:</strong> Perfekt-Streak wird auf 0 gesetzt wenn nicht alle Quests erledigt sind
                        </p>
                        <label style="display: flex; align-items: center; gap: 15px; cursor: pointer; font-size: 1.2rem;">
                            <input type="checkbox" id="hardcoreCheckbox" onchange="toggleHardcoreMode(this.checked)" 
                                   style="width: 30px; height: 30px; cursor: pointer;">
                            <span id="hardcoreLabel" style="color: var(--text-primary);">Hardcore Modus: <strong style="color: var(--accent-green);">AUS</strong></span>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Theme Selection -->
            <div class="quest-category" style="margin-top: 30px;">
                <h2 class="category-title"><span class="category-icon">üé®</span> Theme Auswahl</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 15px;">
                    <div class="theme-option" onclick="changeTheme('default')" data-theme="default">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0e27, #1a1f3a); border: 3px solid #ffd700;">
                            <div style="width: 60%; height: 8px; background: #00ff88; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #4da6ff; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Dark RPG (Default)</div>
                    </div>
                    
                    <div class="theme-option" onclick="changeTheme('cyberpunk')" data-theme="cyberpunk">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a0a0a, #1a001a); border: 3px solid #ff00ff;">
                            <div style="width: 60%; height: 8px; background: #00ffff; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #ff00ff; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Cyberpunk Neon</div>
                    </div>
                    
                    <div class="theme-option" onclick="changeTheme('forest')" data-theme="forest">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #1a2f1a, #2d4a2d); border: 3px solid #7cb342;">
                            <div style="width: 60%; height: 8px; background: #aed581; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #66bb6a; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Forest Guardian</div>
                    </div>
                    
                    <div class="theme-option" onclick="changeTheme('sunset')" data-theme="sunset">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #2a1a3a, #3a2a2a); border: 3px solid #ff6b6b;">
                            <div style="width: 60%; height: 8px; background: #ffa500; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #ff6b6b; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Sunset Warrior</div>
                    </div>
                    
                    <div class="theme-option" onclick="changeTheme('ocean')" data-theme="ocean">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0a1a2a, #1a2a3a); border: 3px solid #00bcd4;">
                            <div style="width: 60%; height: 8px; background: #4dd0e1; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #26c6da; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Ocean Depths</div>
                    </div>
                    
                    <div class="theme-option" onclick="changeTheme('light')" data-theme="light">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #f5f5f5, #e0e0e0); border: 3px solid #2196f3;">
                            <div style="width: 60%; height: 8px; background: #4caf50; border-radius: 4px; margin: 5px auto;"></div>
                            <div style="width: 80%; height: 8px; background: #2196f3; border-radius: 4px; margin: 5px auto;"></div>
                        </div>
                        <div class="theme-name">Light Mode</div>
                    </div>
                </div>
            </div>
            
            <!-- Data Management -->
            <div class="quest-category" style="margin-top: 30px;">
                <h2 class="category-title"><span class="category-icon">üíæ</span> Daten Verwaltung</h2>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
                    <!-- Export -->
                    <div style="background: rgba(0,255,136,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-green);">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-green); margin-bottom: 15px;">üì§ Export</h3>
                        <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 1.1rem;">Sichere deinen Fortschritt oder √ºbertrage ihn auf ein anderes Ger√§t.</p>
                        <button class="btn btn-primary" onclick="exportData()" style="width: 100%;">In Zwischenablage kopieren</button>
                        <button class="btn btn-secondary" onclick="downloadData()" style="width: 100%; margin-top: 10px;">Als Datei herunterladen</button>
                    </div>
                    
                    <!-- Import -->
                    <div style="background: rgba(77,166,255,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-blue);">
                        <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-blue); margin-bottom: 15px;">üì• Import</h3>
                        <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 1.1rem;">Lade deinen Fortschritt von einem anderen Ger√§t.</p>
                        <button class="btn btn-secondary" onclick="importData()" style="width: 100%;">Aus Zwischenablage laden</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importFromFile(event)">
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()" style="width: 100%; margin-top: 10px;">Aus Datei laden</button>
                    </div>
                </div>
            </div>
            
            <!-- Danger Zone -->
            <div class="quest-category" style="margin-top: 30px;">
                <div style="background: rgba(255,68,68,0.1); padding: 20px; border-radius: 8px; border: 2px solid var(--accent-red);">
                    <h3 style="font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--accent-red); margin-bottom: 10px;">‚ö†Ô∏è Gef√§hrliche Zone</h3>
                    <p style="color: var(--text-dim); margin-bottom: 15px; font-size: 1.1rem;">Diese Aktion l√∂scht ALLE Daten unwiderruflich (Level, XP, Streak, Quests, To-Dos, Einstellungen).</p>
                    <button class="btn btn-danger" onclick="resetAll()" style="width: 100%;">üóëÔ∏è Alles Zur√ºcksetzen</button>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="button-group">
            <button class="btn btn-primary" onclick="completeDay()">‚ú® Tag Abschlie√üen (Perfekt)</button>
            <button class="btn btn-secondary" onclick="partialCompleteDay()">‚ö° Trotzdem Abschlie√üen</button>
            <button class="btn btn-secondary" onclick="resetDay()">üîÑ Tag Zur√ºcksetzen</button>
        </div>
    </div>
    
    <!-- Level Up Overlay -->
    <div class="level-up-overlay" id="levelUpOverlay">
        <div class="level-up-content">
            <div class="level-up-title">LEVEL UP!</div>
            <div class="level-up-text">Level <span id="newLevel">2</span></div>
        </div>
    </div>
    
    <script>
        // Quest Data
        const quests = {
            daily: {
                schule: [
                    { text: "45 min Lernen (fokussiert)", xp: 15 },
                    { text: "Hausaufgaben vollst√§ndig", xp: 12 },
                    { text: "Lernstoff kurz zusammenfassen", xp: 10 },
                    { text: "Kein Prokrastinieren bis 16:00", xp: 15 }
                ],
                gesundheit: [
                    { text: "‚â• 8.000 Schritte / Bewegung", xp: 12 },
                    { text: "‚â• 2 Liter Wasser", xp: 10 },
                    { text: "‚â• 7 h Schlaf", xp: 12 },
                    { text: "Kein Energy / Softdrink", xp: 10 }
                ],
                ordnung: [
                    { text: "Schreibtisch aufger√§umt", xp: 8 },
                    { text: "Zimmer 10-Min-Reset", xp: 8 },
                    { text: "Handy / Fotos / Mails ausgemistet", xp: 10 }
                ],
                mindset: [
                    { text: "5‚Äì10 min Journaling", xp: 12 },
                    { text: "Aufgeschobene Aufgabe erledigt", xp: 15 },
                    { text: "Kein Social Media vor Schule", xp: 10 }
                ]
            },
            weekly: {
                koerper: [
                    { text: "3√ó Training (Gym / Calisthenics)", xp: 30 },
                    { text: "1√ó Cardio / langer Spaziergang", xp: 20 },
                    { text: "Mobility / Dehnen", xp: 20 }
                ],
                schule: [
                    { text: "Wochenstoff wiederholt", xp: 25 },
                    { text: "Klassenarbeit vorbereitet", xp: 30 },
                    { text: "Praktikum / Bewerbung vorangebracht", xp: 35 }
                ],
                life: [
                    { text: "Zimmer komplett sauber", xp: 20 },
                    { text: "Dateien / Backups organisiert", xp: 25 },
                    { text: "Finanzen / Ausgaben gecheckt", xp: 25 }
                ]
            }
        };
        
        // Get all quests including custom ones
        function getAllQuests() {
            const allQuests = JSON.parse(JSON.stringify(quests)); // Deep copy
            
            // Remove hidden quests
            if (gameState.hiddenQuests) {
                gameState.hiddenQuests.forEach(questKey => {
                    const [type, category, index] = questKey.split('-');
                    if (allQuests[type] && allQuests[type][category]) {
                        allQuests[type][category].splice(parseInt(index), 1);
                    }
                });
            }
            
            // Add custom quests
            gameState.customQuests.forEach(customQuest => {
                const [type, category] = customQuest.category.split('-');
                if (!allQuests[type][category]) {
                    allQuests[type][category] = [];
                }
                allQuests[type][category].push({
                    text: customQuest.text,
                    xp: customQuest.xp,
                    isCustom: true,
                    id: customQuest.id
                });
            });
            
            return allQuests;
        }
        
        // Game State
        let gameState = {
            level: 1,
            xp: 0,
            totalXP: 0,
            streak: 0,
            partialStreak: 0,
            longestStreak: 0,
            longestPartialStreak: 0,
            dailyCompleted: {},
            weeklyCompleted: {},
            lastCompletedDate: null,
            lastPartialCompletedDate: null,
            weekStartDate: null,
            totalQuestsCompleted: 0,
            totalQuestsAttempted: 0,
            customQuests: [],
            todos: [],
            currentTheme: 'default',
            settings: {
                minQuestsForActiveStreak: 3,
                hardcoreMode: false
            }
        };
        
        // Theme Definitions
        const themes = {
            default: {
                name: 'Dark RPG',
                '--bg-dark': '#0a0e27',
                '--bg-panel': '#1a1f3a',
                '--bg-quest': '#252b4a',
                '--accent-gold': '#ffd700',
                '--accent-blue': '#4da6ff',
                '--accent-green': '#00ff88',
                '--accent-red': '#ff4444',
                '--text-primary': '#e0e6ff',
                '--text-dim': '#8892b0',
                '--border': '#3a4466'
            },
            cyberpunk: {
                name: 'Cyberpunk Neon',
                '--bg-dark': '#0a0a0a',
                '--bg-panel': '#1a001a',
                '--bg-quest': '#2a002a',
                '--accent-gold': '#ff00ff',
                '--accent-blue': '#00ffff',
                '--accent-green': '#00ff00',
                '--accent-red': '#ff0080',
                '--text-primary': '#00ffff',
                '--text-dim': '#8000ff',
                '--border': '#ff00ff'
            },
            forest: {
                name: 'Forest Guardian',
                '--bg-dark': '#1a2f1a',
                '--bg-panel': '#2d4a2d',
                '--bg-quest': '#3a5a3a',
                '--accent-gold': '#ffd54f',
                '--accent-blue': '#81c784',
                '--accent-green': '#aed581',
                '--accent-red': '#ff8a65',
                '--text-primary': '#e8f5e9',
                '--text-dim': '#a5d6a7',
                '--border': '#66bb6a'
            },
            sunset: {
                name: 'Sunset Warrior',
                '--bg-dark': '#2a1a3a',
                '--bg-panel': '#3a2a2a',
                '--bg-quest': '#4a3a3a',
                '--accent-gold': '#ffb74d',
                '--accent-blue': '#ba68c8',
                '--accent-green': '#ffa726',
                '--accent-red': '#ff6b6b',
                '--text-primary': '#ffe0b2',
                '--text-dim': '#ffab91',
                '--border': '#ff8a65'
            },
            ocean: {
                name: 'Ocean Depths',
                '--bg-dark': '#0a1a2a',
                '--bg-panel': '#1a2a3a',
                '--bg-quest': '#2a3a4a',
                '--accent-gold': '#ffd700',
                '--accent-blue': '#00bcd4',
                '--accent-green': '#4dd0e1',
                '--accent-red': '#ff5252',
                '--text-primary': '#e1f5fe',
                '--text-dim': '#80deea',
                '--border': '#26c6da'
            },
            light: {
                name: 'Light Mode',
                '--bg-dark': '#f5f5f5',
                '--bg-panel': '#ffffff',
                '--bg-quest': '#fafafa',
                '--accent-gold': '#ff9800',
                '--accent-blue': '#2196f3',
                '--accent-green': '#4caf50',
                '--accent-red': '#f44336',
                '--text-primary': '#212121',
                '--text-dim': '#757575',
                '--border': '#e0e0e0'
            }
        };
        
        // Initialize
        function init() {
            loadGameState();
            applyTheme(gameState.currentTheme || 'default');
            updateThemeSelection();
            loadSettings();
            renderQuests();
            updateStats();
            checkNewDay();
            checkNewWeek();
            renderTodos();
            renderManageQuests();
        }
        
        // Render all quests
        function renderQuests() {
            const allQuests = getAllQuests();
            
            // Daily quests
            for (let category in allQuests.daily) {
                const container = document.getElementById(`daily-${category}`);
                container.innerHTML = '';
                allQuests.daily[category].forEach((quest, index) => {
                    const questId = `daily-${category}-${index}`;
                    const completed = gameState.dailyCompleted[questId] || false;
                    container.innerHTML += createQuestHTML(questId, quest, completed);
                });
            }
            
            // Weekly quests
            for (let category in allQuests.weekly) {
                const container = document.getElementById(`weekly-${category}`);
                container.innerHTML = '';
                allQuests.weekly[category].forEach((quest, index) => {
                    const questId = `weekly-${category}-${index}`;
                    const completed = gameState.weeklyCompleted[questId] || false;
                    container.innerHTML += createQuestHTML(questId, quest, completed);
                });
            }
        }
        
        // Create quest HTML
        function createQuestHTML(id, quest, completed) {
            return `
                <div class="quest-item ${completed ? 'completed' : ''}" onclick="toggleQuest('${id}', ${quest.xp})">
                    <div class="quest-checkbox"></div>
                    <div class="quest-text">${quest.text}</div>
                    <div class="quest-xp">+${quest.xp} XP</div>
                </div>
            `;
        }
        
        // Toggle quest completion
        function toggleQuest(questId, xp) {
            const isDaily = questId.startsWith('daily-');
            const completedObj = isDaily ? gameState.dailyCompleted : gameState.weeklyCompleted;
            
            if (completedObj[questId]) {
                // Uncomplete
                completedObj[questId] = false;
                gameState.xp -= xp;
                gameState.totalXP -= xp;
                gameState.totalQuestsCompleted--;
            } else {
                // Complete
                completedObj[questId] = true;
                gameState.xp += xp;
                gameState.totalXP += xp;
                gameState.totalQuestsCompleted++;
                checkLevelUp();
            }
            
            saveGameState();
            renderQuests();
            updateStats();
        }
        
        // Check level up
        function checkLevelUp() {
            const xpForNextLevel = gameState.level * 100;
            if (gameState.xp >= xpForNextLevel) {
                gameState.xp -= xpForNextLevel;
                gameState.level++;
                showLevelUp();
            }
        }
        
        // Show level up animation
        function showLevelUp() {
            const overlay = document.getElementById('levelUpOverlay');
            document.getElementById('newLevel').textContent = gameState.level;
            overlay.classList.add('show');
            setTimeout(() => overlay.classList.remove('show'), 2000);
        }
        
        // Update stats display
        function updateStats() {
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('currentStreak').textContent = gameState.streak + 'üî•';
            document.getElementById('partialStreak').textContent = gameState.partialStreak + '‚ö°';
            
            const dailyTotal = Object.keys(quests.daily).reduce((sum, cat) => sum + quests.daily[cat].length, 0);
            const dailyCompleted = Object.values(gameState.dailyCompleted).filter(v => v).length;
            document.getElementById('todayProgress').textContent = `${dailyCompleted}/${dailyTotal}`;
            
            const weeklyTotal = Object.keys(quests.weekly).reduce((sum, cat) => sum + quests.weekly[cat].length, 0);
            const weeklyCompleted = Object.values(gameState.weeklyCompleted).filter(v => v).length;
            document.getElementById('weekProgress').textContent = `${weeklyCompleted}/${weeklyTotal}`;
            
            const xpForNextLevel = gameState.level * 100;
            const xpPercent = (gameState.xp / xpForNextLevel) * 100;
            document.getElementById('xpText').textContent = `${gameState.xp} / ${xpForNextLevel} XP`;
            document.getElementById('xpFill').style.width = xpPercent + '%';
            
            // Statistics tab
            document.getElementById('totalXP').textContent = gameState.totalXP;
            document.getElementById('totalCompleted').textContent = gameState.totalQuestsCompleted;
            document.getElementById('longestStreak').textContent = gameState.longestStreak + ' Tage üî•';
            document.getElementById('longestPartialStreak').textContent = gameState.longestPartialStreak + ' Tage ‚ö°';
            
            const successRate = gameState.totalQuestsAttempted > 0 
                ? Math.round((gameState.totalQuestsCompleted / gameState.totalQuestsAttempted) * 100)
                : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // Update charts
            updateCharts();
        }
        
        // ========== CHART FUNCTIONS ==========
        
        let pieChart, barChart, lineChart;
        
        function updateCharts() {
            updatePieChart();
            updateBarChart();
            updateLineChart();
        }
        
        function updatePieChart() {
            const allQuests = getAllQuests();
            const dailyTotal = Object.keys(allQuests.daily).reduce((sum, cat) => sum + allQuests.daily[cat].length, 0);
            const weeklyTotal = Object.keys(allQuests.weekly).reduce((sum, cat) => sum + allQuests.weekly[cat].length, 0);
            const dailyCompleted = Object.values(gameState.dailyCompleted).filter(v => v).length;
            const weeklyCompleted = Object.values(gameState.weeklyCompleted).filter(v => v).length;
            
            const ctx = document.getElementById('questPieChart');
            if (!ctx) return;
            
            if (pieChart) pieChart.destroy();
            
            pieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Daily Erledigt', 'Daily Offen', 'Weekly Erledigt', 'Weekly Offen'],
                    datasets: [{
                        data: [dailyCompleted, dailyTotal - dailyCompleted, weeklyCompleted, weeklyTotal - weeklyCompleted],
                        backgroundColor: [
                            'rgba(0, 255, 136, 0.8)',
                            'rgba(77, 166, 255, 0.3)',
                            'rgba(255, 215, 0, 0.8)',
                            'rgba(255, 68, 68, 0.3)'
                        ],
                        borderColor: [
                            'rgba(0, 255, 136, 1)',
                            'rgba(77, 166, 255, 1)',
                            'rgba(255, 215, 0, 1)',
                            'rgba(255, 68, 68, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#e0e6ff',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 31, 58, 0.95)',
                            titleColor: '#ffd700',
                            bodyColor: '#e0e6ff',
                            borderColor: '#3a4466',
                            borderWidth: 2,
                            titleFont: {
                                family: 'Press Start 2P',
                                size: 10
                            },
                            bodyFont: {
                                family: 'VT323',
                                size: 16
                            },
                            padding: 12
                        }
                    }
                }
            });
        }
        
        function updateBarChart() {
            const allQuests = getAllQuests();
            const categories = {
                'Schule': 0,
                'Gesundheit': 0,
                'Ordnung': 0,
                'Mindset': 0,
                'K√∂rper': 0,
                'Zukunft': 0,
                'Life': 0
            };
            
            // Calculate XP by category
            for (let questId in gameState.dailyCompleted) {
                if (gameState.dailyCompleted[questId]) {
                    const [type, category, index] = questId.split('-');
                    const quest = allQuests.daily[category]?.[parseInt(index)];
                    if (quest) {
                        if (category === 'schule') categories['Schule'] += quest.xp;
                        if (category === 'gesundheit') categories['Gesundheit'] += quest.xp;
                        if (category === 'ordnung') categories['Ordnung'] += quest.xp;
                        if (category === 'mindset') categories['Mindset'] += quest.xp;
                    }
                }
            }
            
            for (let questId in gameState.weeklyCompleted) {
                if (gameState.weeklyCompleted[questId]) {
                    const [type, category, index] = questId.split('-');
                    const quest = allQuests.weekly[category]?.[parseInt(index)];
                    if (quest) {
                        if (category === 'koerper') categories['K√∂rper'] += quest.xp;
                        if (category === 'schule') categories['Zukunft'] += quest.xp;
                        if (category === 'life') categories['Life'] += quest.xp;
                    }
                }
            }
            
            const ctx = document.getElementById('xpBarChart');
            if (!ctx) return;
            
            if (barChart) barChart.destroy();
            
            barChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        label: 'XP Gesammelt',
                        data: Object.values(categories),
                        backgroundColor: 'rgba(0, 255, 136, 0.6)',
                        borderColor: 'rgba(0, 255, 136, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#8892b0',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(58, 68, 102, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e0e6ff',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 31, 58, 0.95)',
                            titleColor: '#ffd700',
                            bodyColor: '#e0e6ff',
                            borderColor: '#3a4466',
                            borderWidth: 2,
                            titleFont: {
                                family: 'Press Start 2P',
                                size: 10
                            },
                            bodyFont: {
                                family: 'VT323',
                                size: 16
                            },
                            padding: 12
                        }
                    }
                }
            });
        }
        
        function updateLineChart() {
            // Get last 7 days of data
            if (!gameState.dailyHistory) {
                gameState.dailyHistory = [];
            }
            
            const last7Days = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' });
                
                const historyEntry = gameState.dailyHistory.find(h => h.date === date.toDateString());
                last7Days.push({
                    label: dateStr,
                    completed: historyEntry ? historyEntry.completed : 0,
                    xp: historyEntry ? historyEntry.xp : 0
                });
            }
            
            const ctx = document.getElementById('weeklyLineChart');
            if (!ctx) return;
            
            if (lineChart) lineChart.destroy();
            
            lineChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days.map(d => d.label),
                    datasets: [
                        {
                            label: 'Erledigte Quests',
                            data: last7Days.map(d => d.completed),
                            borderColor: 'rgba(77, 166, 255, 1)',
                            backgroundColor: 'rgba(77, 166, 255, 0.2)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y'
                        },
                        {
                            label: 'XP Verdient',
                            data: last7Days.map(d => d.xp),
                            borderColor: 'rgba(255, 215, 0, 1)',
                            backgroundColor: 'rgba(255, 215, 0, 0.2)',
                            tension: 0.4,
                            fill: true,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            ticks: {
                                color: '#4da6ff',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(58, 68, 102, 0.3)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            ticks: {
                                color: '#ffd700',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        },
                        x: {
                            ticks: {
                                color: '#e0e6ff',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                }
                            },
                            grid: {
                                color: 'rgba(58, 68, 102, 0.3)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e0e6ff',
                                font: {
                                    family: 'VT323',
                                    size: 14
                                },
                                padding: 15
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(26, 31, 58, 0.95)',
                            titleColor: '#ffd700',
                            bodyColor: '#e0e6ff',
                            borderColor: '#3a4466',
                            borderWidth: 2,
                            titleFont: {
                                family: 'Press Start 2P',
                                size: 10
                            },
                            bodyFont: {
                                family: 'VT323',
                                size: 16
                            },
                            padding: 12
                        }
                    }
                }
            });
        }
        
        // Complete day
        function completeDay() {
            const today = new Date().toDateString();
            
            // Check if all daily quests are completed
            const allQuests = getAllQuests();
            const dailyTotal = Object.keys(allQuests.daily).reduce((sum, cat) => sum + allQuests.daily[cat].length, 0);
            const dailyCompleted = Object.values(gameState.dailyCompleted).filter(v => v).length;
            
            if (dailyCompleted === dailyTotal) {
                // Calculate XP earned today
                let todayXP = 0;
                for (let questId in gameState.dailyCompleted) {
                    if (gameState.dailyCompleted[questId]) {
                        const [type, category, index] = questId.split('-');
                        const quest = allQuests.daily[category]?.[parseInt(index)];
                        if (quest) todayXP += quest.xp;
                    }
                }
                
                // Bonus XP for completing all dailies
                todayXP += 50;
                gameState.xp += 50;
                gameState.totalXP += 50;
                
                // Update perfect streak
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (gameState.lastCompletedDate === yesterday.toDateString()) {
                    gameState.streak++;
                } else {
                    gameState.streak = 1;
                }
                
                if (gameState.streak > gameState.longestStreak) {
                    gameState.longestStreak = gameState.streak;
                }
                
                // Also update partial streak
                if (gameState.lastPartialCompletedDate === yesterday.toDateString()) {
                    gameState.partialStreak++;
                } else {
                    gameState.partialStreak = 1;
                }
                
                if (gameState.partialStreak > gameState.longestPartialStreak) {
                    gameState.longestPartialStreak = gameState.partialStreak;
                }
                
                gameState.lastCompletedDate = today;
                gameState.lastPartialCompletedDate = today;
                
                // Save to daily history
                if (!gameState.dailyHistory) gameState.dailyHistory = [];
                const existingEntry = gameState.dailyHistory.find(h => h.date === today);
                if (existingEntry) {
                    existingEntry.completed = dailyCompleted;
                    existingEntry.xp = todayXP;
                } else {
                    gameState.dailyHistory.push({
                        date: today,
                        completed: dailyCompleted,
                        xp: todayXP
                    });
                }
                
                // Keep only last 30 days
                if (gameState.dailyHistory.length > 30) {
                    gameState.dailyHistory = gameState.dailyHistory.slice(-30);
                }
                
                checkLevelUp();
                saveGameState();
                updateStats();
                
                alert(`üéâ Perfekter Tag abgeschlossen!\n\n+50 Bonus XP!\nüî• Perfekt-Streak: ${gameState.streak} Tage\n‚ö° Aktiv-Streak: ${gameState.partialStreak} Tage`);
            } else {
                alert(`‚ö†Ô∏è Du hast erst ${dailyCompleted}/${dailyTotal} Daily Quests abgeschlossen!\n\nNutze "Trotzdem Abschlie√üen" wenn du heute nicht alles schaffst.`);
            }
        }
        
        // Partial complete day (without bonus)
        function partialCompleteDay() {
            const today = new Date().toDateString();
            const allQuests = getAllQuests();
            const dailyTotal = Object.keys(allQuests.daily).reduce((sum, cat) => sum + allQuests.daily[cat].length, 0);
            const dailyCompleted = Object.values(gameState.dailyCompleted).filter(v => v).length;
            
            const minQuests = gameState.settings.minQuestsForActiveStreak || 3;
            
            if (dailyCompleted < minQuests) {
                alert(`‚ö†Ô∏è Du hast erst ${dailyCompleted}/${minQuests} Quests erledigt!\n\nDu brauchst mindestens ${minQuests} Quests f√ºr die Aktiv-Streak.\n(Du kannst diese Zahl in den Einstellungen √§ndern)`);
                return;
            }
            
            if (dailyCompleted === dailyTotal) {
                alert('üí° Du hast alle Quests erledigt!\n\nNutze "Tag Abschlie√üen (Perfekt)" f√ºr den Bonus!');
                return;
            }
            
            // Calculate XP earned today (already counted, no bonus)
            let todayXP = 0;
            for (let questId in gameState.dailyCompleted) {
                if (gameState.dailyCompleted[questId]) {
                    const [type, category, index] = questId.split('-');
                    const quest = allQuests.daily[category]?.[parseInt(index)];
                    if (quest) todayXP += quest.xp;
                }
            }
            
            // Update partial streak only
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (gameState.lastPartialCompletedDate === yesterday.toDateString()) {
                gameState.partialStreak++;
            } else {
                gameState.partialStreak = 1;
            }
            
            if (gameState.partialStreak > gameState.longestPartialStreak) {
                gameState.longestPartialStreak = gameState.partialStreak;
            }
            
            // Handle perfect streak based on hardcore mode
            const hardcoreMode = gameState.settings.hardcoreMode || false;
            let streakMessage = '';
            
            if (hardcoreMode) {
                // Hardcore: Reset perfect streak
                gameState.streak = 0;
                streakMessage = 'üî• Perfekt-Streak zur√ºckgesetzt (Hardcore Modus)';
            } else {
                // Safe Mode: Keep perfect streak (frozen)
                streakMessage = `üî• Perfekt-Streak bleibt bei ${gameState.streak} (gesichert)`;
            }
            
            gameState.lastPartialCompletedDate = today;
            
            // Save to daily history
            if (!gameState.dailyHistory) gameState.dailyHistory = [];
            const existingEntry = gameState.dailyHistory.find(h => h.date === today);
            if (existingEntry) {
                existingEntry.completed = dailyCompleted;
                existingEntry.xp = todayXP;
            } else {
                gameState.dailyHistory.push({
                    date: today,
                    completed: dailyCompleted,
                    xp: todayXP
                });
            }
            
            // Keep only last 30 days
            if (gameState.dailyHistory.length > 30) {
                gameState.dailyHistory = gameState.dailyHistory.slice(-30);
            }
            
            saveGameState();
            updateStats();
            
            alert(`‚úÖ Tag abgeschlossen (${dailyCompleted}/${dailyTotal} Quests)\n\nKein Bonus-XP, aber:\n‚ö° Aktiv-Streak: ${gameState.partialStreak} Tage\n${streakMessage}`);
        }
        
        // Reset day
        function resetDay() {
            if (confirm('Willst du wirklich alle Daily Quests zur√ºcksetzen?')) {
                // Calculate XP to subtract
                let xpToSubtract = 0;
                for (let questId in gameState.dailyCompleted) {
                    if (gameState.dailyCompleted[questId]) {
                        const parts = questId.split('-');
                        const category = parts[1];
                        const index = parseInt(parts[2]);
                        xpToSubtract += quests.daily[category][index].xp;
                    }
                }
                
                gameState.dailyCompleted = {};
                gameState.xp = Math.max(0, gameState.xp - xpToSubtract);
                gameState.totalXP = Math.max(0, gameState.totalXP - xpToSubtract);
                
                saveGameState();
                renderQuests();
                updateStats();
            }
        }
        
        // Reset all
        function resetAll() {
            if (confirm('‚ö†Ô∏è WARNUNG: Dies setzt ALLES zur√ºck (Level, XP, Streak, alle Quests, Custom Quests, To-Dos)! Fortfahren?')) {
                if (confirm('Bist du dir WIRKLICH sicher?')) {
                    gameState = {
                        level: 1,
                        xp: 0,
                        totalXP: 0,
                        streak: 0,
                        partialStreak: 0,
                        longestStreak: 0,
                        longestPartialStreak: 0,
                        dailyCompleted: {},
                        weeklyCompleted: {},
                        lastCompletedDate: null,
                        lastPartialCompletedDate: null,
                        weekStartDate: null,
                        totalQuestsCompleted: 0,
                        totalQuestsAttempted: 0,
                        customQuests: [],
                        todos: [],
                        hiddenQuests: [],
                        currentTheme: 'default',
                        settings: {
                            minQuestsForActiveStreak: 3,
                            hardcoreMode: false
                        }
                    };
                    saveGameState();
                    loadSettings();
                    renderQuests();
                    updateStats();
                    renderTodos();
                    renderManageQuests();
                    alert('Alles wurde zur√ºckgesetzt. Viel Erfolg beim Neustart!');
                }
            }
        }
        
        // Check if new day
        function checkNewDay() {
            const today = new Date().toDateString();
            const lastSaved = localStorage.getItem('lastAccessDate');
            
            if (lastSaved && lastSaved !== today) {
                // New day - reset daily quests
                gameState.dailyCompleted = {};
                
                // Count daily quests as attempted
                const dailyTotal = Object.keys(quests.daily).reduce((sum, cat) => sum + quests.daily[cat].length, 0);
                gameState.totalQuestsAttempted += dailyTotal;
            }
            
            localStorage.setItem('lastAccessDate', today);
        }
        
        // Check if new week
        function checkNewWeek() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay() + 1); // Monday
            const weekStartString = weekStart.toDateString();
            
            if (!gameState.weekStartDate || gameState.weekStartDate !== weekStartString) {
                // New week - reset weekly quests
                if (gameState.weekStartDate) {
                    const weeklyTotal = Object.keys(quests.weekly).reduce((sum, cat) => sum + quests.weekly[cat].length, 0);
                    gameState.totalQuestsAttempted += weeklyTotal;
                }
                
                gameState.weeklyCompleted = {};
                gameState.weekStartDate = weekStartString;
            }
        }
        
        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update sections
            document.querySelectorAll('.quest-section').forEach(section => section.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
        }
        
        // Save game state
        function saveGameState() {
            localStorage.setItem('questTrackerState', JSON.stringify(gameState));
        }
        
        // Load game state
        function loadGameState() {
            const saved = localStorage.getItem('questTrackerState');
            if (saved) {
                gameState = JSON.parse(saved);
                // Ensure new properties exist
                if (!gameState.customQuests) gameState.customQuests = [];
                if (!gameState.todos) gameState.todos = [];
                if (!gameState.hiddenQuests) gameState.hiddenQuests = [];
                if (!gameState.dailyHistory) gameState.dailyHistory = [];
                if (!gameState.currentTheme) gameState.currentTheme = 'default';
                if (!gameState.partialStreak) gameState.partialStreak = 0;
                if (!gameState.longestPartialStreak) gameState.longestPartialStreak = 0;
                if (!gameState.lastPartialCompletedDate) gameState.lastPartialCompletedDate = null;
                if (!gameState.settings) {
                    gameState.settings = {
                        minQuestsForActiveStreak: 3,
                        hardcoreMode: false
                    };
                }
            }
        }
        
        // ========== THEME SYSTEM ==========
        
        function changeTheme(themeName) {
            gameState.currentTheme = themeName;
            applyTheme(themeName);
            updateThemeSelection();
            saveGameState();
            
            // Update charts with new colors
            if (typeof updateCharts === 'function') {
                updateCharts();
            }
        }
        
        function applyTheme(themeName) {
            const theme = themes[themeName] || themes.default;
            const root = document.documentElement;
            
            for (const [property, value] of Object.entries(theme)) {
                if (property.startsWith('--')) {
                    root.style.setProperty(property, value);
                }
            }
        }
        
        function updateThemeSelection() {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.theme === gameState.currentTheme) {
                    option.classList.add('active');
                }
            });
        }
        
        // ========== EXPORT / IMPORT SYSTEM ==========
        
        function exportData() {
            const exportData = JSON.stringify(gameState, null, 2);
            
            navigator.clipboard.writeText(exportData).then(() => {
                alert('‚úÖ Fortschritt in Zwischenablage kopiert!\n\nDu kannst ihn jetzt per WhatsApp, Telegram, etc. an dein anderes Ger√§t senden.');
            }).catch(err => {
                alert('‚ùå Fehler beim Kopieren. Versuche es mit "Als Datei herunterladen".');
                console.error('Copy failed:', err);
            });
        }
        
        function downloadData() {
            const exportData = JSON.stringify(gameState, null, 2);
            const blob = new Blob([exportData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quest-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ Backup-Datei heruntergeladen!');
        }
        
        function importData() {
            navigator.clipboard.readText().then(text => {
                try {
                    const importedData = JSON.parse(text);
                    
                    if (confirm('‚ö†Ô∏è Dies √ºberschreibt deinen aktuellen Fortschritt!\n\nM√∂chtest du fortfahren?')) {
                        gameState = importedData;
                        
                        // Ensure all required properties exist
                        if (!gameState.customQuests) gameState.customQuests = [];
                        if (!gameState.todos) gameState.todos = [];
                        if (!gameState.hiddenQuests) gameState.hiddenQuests = [];
                        if (!gameState.dailyHistory) gameState.dailyHistory = [];
                        if (!gameState.currentTheme) gameState.currentTheme = 'default';
                        if (!gameState.settings) {
                            gameState.settings = {
                                minQuestsForActiveStreak: 3,
                                hardcoreMode: false
                            };
                        }
                        
                        saveGameState();
                        applyTheme(gameState.currentTheme);
                        updateThemeSelection();
                        loadSettings();
                        renderQuests();
                        renderTodos();
                        renderManageQuests();
                        updateStats();
                        
                        alert('‚úÖ Fortschritt erfolgreich importiert!');
                    }
                } catch (err) {
                    alert('‚ùå Ung√ºltige Daten in der Zwischenablage!\n\nStelle sicher, dass du die Daten korrekt kopiert hast.');
                    console.error('Import failed:', err);
                }
            }).catch(err => {
                alert('‚ùå Fehler beim Lesen der Zwischenablage.\n\nVersuche es mit "Aus Datei laden".');
                console.error('Clipboard read failed:', err);
            });
        }
        
        function importFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('‚ö†Ô∏è Dies √ºberschreibt deinen aktuellen Fortschritt!\n\nM√∂chtest du fortfahren?')) {
                        gameState = importedData;
                        
                        // Ensure all required properties exist
                        if (!gameState.customQuests) gameState.customQuests = [];
                        if (!gameState.todos) gameState.todos = [];
                        if (!gameState.hiddenQuests) gameState.hiddenQuests = [];
                        if (!gameState.dailyHistory) gameState.dailyHistory = [];
                        if (!gameState.currentTheme) gameState.currentTheme = 'default';
                        if (!gameState.settings) {
                            gameState.settings = {
                                minQuestsForActiveStreak: 3,
                                hardcoreMode: false
                            };
                        }
                        
                        saveGameState();
                        applyTheme(gameState.currentTheme);
                        updateThemeSelection();
                        loadSettings();
                        renderQuests();
                        renderTodos();
                        renderManageQuests();
                        updateStats();
                        
                        alert('‚úÖ Fortschritt erfolgreich importiert!');
                    }
                } catch (err) {
                    alert('‚ùå Ung√ºltige Datei!\n\nStelle sicher, dass es eine g√ºltige Quest Tracker Backup-Datei ist.');
                    console.error('File import failed:', err);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }
        
        // ========== TODO LIST FUNCTIONS ==========
        
        // Add new todo
        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (text) {
                gameState.todos.push({
                    id: Date.now(),
                    text: text,
                    completed: false,
                    createdAt: new Date().toISOString()
                });
                
                input.value = '';
                saveGameState();
                renderTodos();
            }
        }
        
        // Toggle todo completion
        function toggleTodo(id) {
            const todo = gameState.todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                saveGameState();
                renderTodos();
            }
        }
        
        // Delete todo
        function deleteTodo(id) {
            gameState.todos = gameState.todos.filter(t => t.id !== id);
            saveGameState();
            renderTodos();
        }
        
        // Render todos
        function renderTodos() {
            const container = document.getElementById('todoList');
            if (gameState.todos.length === 0) {
                container.innerHTML = '<p style="color: var(--text-dim); text-align: center; padding: 20px;">Keine To-Dos vorhanden. F√ºge eine neue Aufgabe hinzu!</p>';
                return;
            }
            
            container.innerHTML = gameState.todos.map(todo => `
                <div class="todo-item ${todo.completed ? 'completed' : ''}">
                    <div class="quest-checkbox" onclick="toggleTodo(${todo.id})" style="cursor: pointer;">
                        ${todo.completed ? '<div style="font-size: 1.5rem; color: var(--bg-dark);">‚úì</div>' : ''}
                    </div>
                    <div class="todo-text">${todo.text}</div>
                    <button class="todo-delete" onclick="deleteTodo(${todo.id})">L√∂schen</button>
                </div>
            `).join('');
        }
        
        // Allow Enter key to add todo
        document.addEventListener('DOMContentLoaded', () => {
            const todoInput = document.getElementById('todoInput');
            if (todoInput) {
                todoInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addTodo();
                });
            }
        });
        
        // ========== CUSTOM QUEST MANAGEMENT ==========
        
        // Add custom quest
        function addCustomQuest() {
            const type = document.getElementById('newQuestType').value;
            const text = document.getElementById('newQuestText').value.trim();
            const xp = parseInt(document.getElementById('newQuestXP').value);
            
            if (!text) {
                alert('Bitte gib eine Quest-Beschreibung ein!');
                return;
            }
            
            if (xp < 1 || xp > 100) {
                alert('XP muss zwischen 1 und 100 liegen!');
                return;
            }
            
            const customQuest = {
                id: Date.now(),
                category: type,
                text: text,
                xp: xp,
                createdAt: new Date().toISOString()
            };
            
            gameState.customQuests.push(customQuest);
            
            // Clear form
            document.getElementById('newQuestText').value = '';
            document.getElementById('newQuestXP').value = '10';
            
            saveGameState();
            renderQuests();
            renderManageQuests();
            
            alert('‚úÖ Quest erfolgreich hinzugef√ºgt!');
        }
        
        // Remove quest (custom or default)
        function removeQuest(type, category, index) {
            const allQuests = getAllQuests();
            const quest = allQuests[type][category][index];
            
            if (quest.isCustom) {
                // Remove custom quest
                gameState.customQuests = gameState.customQuests.filter(q => q.id !== quest.id);
            } else {
                // For default quests, we'll mark them as hidden
                if (!gameState.hiddenQuests) gameState.hiddenQuests = [];
                const questKey = `${type}-${category}-${index}`;
                if (!gameState.hiddenQuests.includes(questKey)) {
                    gameState.hiddenQuests.push(questKey);
                }
            }
            
            saveGameState();
            renderQuests();
            renderManageQuests();
        }
        
        // Render manage quests list
        function renderManageQuests() {
            const container = document.getElementById('manageQuestsList');
            const allQuests = getAllQuests();
            let html = '';
            
            // Daily quests
            html += '<h4 style="color: var(--accent-blue); font-family: \'Press Start 2P\', monospace; font-size: 0.9rem; margin: 20px 0 10px 0;">Daily Quests</h4>';
            for (let category in allQuests.daily) {
                allQuests.daily[category].forEach((quest, index) => {
                    const categoryName = getCategoryDisplayName('daily', category);
                    html += `
                        <div class="manage-quest-item ${quest.isCustom ? 'custom' : ''}" onclick="confirmRemoveQuest('daily', '${category}', ${index}, '${quest.text.replace(/'/g, "\\'")}', ${quest.isCustom || false})">
                            <div class="quest-text" style="flex: 1;">${quest.text}</div>
                            <div class="manage-quest-category">${categoryName}</div>
                            <div class="quest-xp">+${quest.xp} XP</div>
                            ${quest.isCustom ? '<div style="color: var(--accent-blue); font-family: \'Press Start 2P\', monospace; font-size: 0.7rem;">CUSTOM</div>' : ''}
                        </div>
                    `;
                });
            }
            
            // Weekly quests
            html += '<h4 style="color: var(--accent-blue); font-family: \'Press Start 2P\', monospace; font-size: 0.9rem; margin: 20px 0 10px 0;">Weekly Quests</h4>';
            for (let category in allQuests.weekly) {
                allQuests.weekly[category].forEach((quest, index) => {
                    const categoryName = getCategoryDisplayName('weekly', category);
                    html += `
                        <div class="manage-quest-item ${quest.isCustom ? 'custom' : ''}" onclick="confirmRemoveQuest('weekly', '${category}', ${index}, '${quest.text.replace(/'/g, "\\'")}', ${quest.isCustom || false})">
                            <div class="quest-text" style="flex: 1;">${quest.text}</div>
                            <div class="manage-quest-category">${categoryName}</div>
                            <div class="quest-xp">+${quest.xp} XP</div>
                            ${quest.isCustom ? '<div style="color: var(--accent-blue); font-family: \'Press Start 2P\', monospace; font-size: 0.7rem;">CUSTOM</div>' : ''}
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }
        
        // Confirm quest removal
        function confirmRemoveQuest(type, category, index, text, isCustom) {
            const message = isCustom 
                ? `Custom Quest dauerhaft l√∂schen?\n\n"${text}"`
                : `Quest dauerhaft ausblenden?\n\n"${text}"\n\n(Du kannst sie durch "Alles Zur√ºcksetzen" wiederherstellen)`;
            
            if (confirm(message)) {
                removeQuest(type, category, index);
            }
        }
        
        // Get category display name
        function getCategoryDisplayName(type, category) {
            const names = {
                'daily': {
                    'schule': 'Schule / Fokus',
                    'gesundheit': 'Gesundheit',
                    'ordnung': 'Ordnung',
                    'mindset': 'Mindset'
                },
                'weekly': {
                    'koerper': 'K√∂rper',
                    'schule': 'Schule / Zukunft',
                    'life': 'Life'
                }
            };
            return names[type][category] || category;
        }
        
        // ========== SETTINGS FUNCTIONS ==========
        
        function updateMinQuestsSetting(value) {
            gameState.settings.minQuestsForActiveStreak = parseInt(value);
            document.getElementById('minQuestsValue').textContent = value + ' Quest' + (value > 1 ? 's' : '');
            saveGameState();
        }
        
        function toggleHardcoreMode(enabled) {
            gameState.settings.hardcoreMode = enabled;
            const label = document.getElementById('hardcoreLabel');
            if (enabled) {
                label.innerHTML = 'Hardcore Modus: <strong style="color: var(--accent-red);">EIN</strong>';
            } else {
                label.innerHTML = 'Hardcore Modus: <strong style="color: var(--accent-green);">AUS</strong>';
            }
            saveGameState();
        }
        
        function loadSettings() {
            if (!gameState.settings) {
                gameState.settings = {
                    minQuestsForActiveStreak: 3,
                    hardcoreMode: false
                };
            }
            
            // Update UI
            const minQuests = gameState.settings.minQuestsForActiveStreak || 3;
            const hardcoreMode = gameState.settings.hardcoreMode || false;
            
            const slider = document.getElementById('minQuestsSlider');
            const checkbox = document.getElementById('hardcoreCheckbox');
            
            if (slider) {
                slider.value = minQuests;
                document.getElementById('minQuestsValue').textContent = minQuests + ' Quest' + (minQuests > 1 ? 's' : '');
            }
            
            if (checkbox) {
                checkbox.checked = hardcoreMode;
                const label = document.getElementById('hardcoreLabel');
                if (hardcoreMode) {
                    label.innerHTML = 'Hardcore Modus: <strong style="color: var(--accent-red);">EIN</strong>';
                } else {
                    label.innerHTML = 'Hardcore Modus: <strong style="color: var(--accent-green);">AUS</strong>';
                }
            }
        }
        
        // Initialize on load
        init();
        
        // ========== PWA SETUP ==========
        
        // Create manifest dynamically
        const manifest = {
            "name": "Quest Tracker - Level Up Dein Leben",
            "short_name": "Quest Tracker",
            "description": "RPG-style Habit Tracker zum Leveln deines Lebens",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#0a0e27",
            "theme_color": "#0a0e27",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Crect width='512' height='512' fill='%230a0e27'/%3E%3Ctext x='256' y='340' font-size='280' text-anchor='middle' fill='%23ffd700' font-family='Arial'%3E‚öîÔ∏è%3C/text%3E%3C/svg%3E",
                    "sizes": "512x512",
                    "type": "image/svg+xml",
                    "purpose": "any maskable"
                }
            ]
        };
        
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').setAttribute('href', manifestURL);
    </script>
</body>
</html>